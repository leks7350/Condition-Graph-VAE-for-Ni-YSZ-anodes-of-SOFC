# Condition Graph VAE for Ni YSZ anodes of SOFC
В рамках данного проекта проводится анализ трехфазной стуктуры анодного слоя (Ni-YSZ) твердооксидного топливного элемента (ТОТЭ, SOFC).

Исходными данными для формирования датасета является данные работы "FIB-tomography data of Ni-YSZ anodes for Solid Oxide Fuel Cells (SOFC): Comparison of pristine and degraded materials (before/after redox cycling)" (Holzer, L., Pecho, O., Hocker, T., Iwanschitz, B., & Mai, A. (2020). FIB-tomography data of Ni-YSZ anodes for Solid Oxide Fuel Cells (SOFC): Comparison of pristine and degraded materials (before/after redox cycling) (Версия 1) [Data set]. Zenodo. https://doi.org/10.5281/zenodo.4056538)

# Описание исследуемых материалов
### 1. Общее назначение и внешний вид
Ni-YSZ — это пористая, механически прочная, электропроводящая губка, которая служит:
- Местом протекания реакции: Окисления водорода (или углеводородов).
- Электронным проводником: От места реакции к токосъемнику.
- Путем для подачи топлива: Газы свободно диффундируют сквозь поры.
- Подложкой/носителем: Для тонкого электролита (часто YSZ), который наносят поверх него.

В сечении ТОТЭ (электролит-поддерживающая конструкция) это самый толстый слой (от 300 до 1000 мкм). Он выглядит как мелкозернистая, матовая, серо-черная пластина. После восстановления NiO до Ni он приобретает металлический блеск в изломе.

### 2. Трехфазная структура: Сердце системы
Ключевое понятие — трехфазные границы (ТФГ). Электрохимическая реакция `(H₂ + O²⁻ → H₂O + 2e⁻)` эффективно протекает только в местах, где одновременно присутствуют:
- `Ni` — катализатор диссоциации `H₂` и проводник электронов.
- `YSZ` — проводник ионов кислорода (`O²⁻`).
- `Пора` — канал для подвода газообразного `H₂` и отвода паров `H₂O`.

Таким образом, структура — это взаимопроникающая сеть (интерпенетрирующая матрица) этих трех компонентов.

### Эволюция структуры во время работы (Деградация)
Структура не статична, что является основной проблемой:
- **коалесценция** (укрупнение) частиц `Ni`: Высокая температура и наличие пара приводят к "спеканию" наночастиц `Ni` в более крупные капли (как ртуть на стекле). Это разрывает `Ni-сеть`, увеличивает сопротивление, сокращает длину `ТФГ`. На SEM это выглядит как увеличение среднего размера частиц `Ni` и их изолированность.
- **отравление**: примеси (например, сера) блокируют активные центры на поверхности `Ni`.
- **окисление-восстановление**: циклы окисления (если поступает кислород) и восстановления `Ni` вызывают повторные изменения объема, разрушающие тонкую структуру `YSZ-каркаса`.
- **разрушение** cтруктуры `YSZ` при изменении объема `NiO`

<img height="400" alt="Без названия (4)" src="https://github.com/user-attachments/assets/2f71552f-9f9f-4e3b-8ef9-72ee3d089f1b" />


## Описание исходных данных: ##
Набор данных содержит трехмерные стеки изображений, полученные с помощью ионно-лучевой томографии (FIB-томографии) с анодов из никель-иттрий-сульфидного диоксида циркония (Ni-YSZ) для твердооксидных топливных элементов (SOFC).

Данные были собраны с трех различных анодов из Ni-YSZ (мелкозернистых, среднезернистых и крупнозернистых). Каждый из этих анодов исследовался сначала в исходном состоянии (после спекания и восстановления), а затем также в деградированном состоянии (после воздействия 8 окислительно-восстановительных циклов).

Затем 6 томограмм представлены в виде стопок 2D-изображений в формате TIFF в двух разных версиях: в виде изображений в оттенках серого (исходные данные) и в виде сегментированных изображений (Ni = белый, YSZ = серый и поры = черный).

### Срезы образцов ###
<table width=100%>
  <tr>
    <th>-</th>
    <th>Мелкозернистые (fine)</th>
    <th>Среднезернистые (medium)</th>
    <th>Крупнозернистые (coarse)</th>
  </tr>
  <tr>
    <td width="150">Исходное состояние (pristine)</td>
    <td><img width="200"  alt="pristine_fine" src="https://github.com/user-attachments/assets/d429f9fa-0a94-469e-b1a7-55eb1b2b399e" /></td>
    <td><img width="200" alt="pristine_medium" src="https://github.com/user-attachments/assets/91e15ab6-0b13-484f-877d-5fa88943f711" /></td>
    <td><img width="200"  alt="prisitne_coarse" src="https://github.com/user-attachments/assets/7f9cd6a0-4af8-4c64-9b61-38fc94208eb2" /></td>
  </tr>
  <tr>
    <td width="150">Деградация после 8 редокс-циклов (degraded)</td>
    <td><img width="200" alt="degraded_fine" src="https://github.com/user-attachments/assets/64e22a2b-da6f-4f60-a6e7-9cbc1a86d237" /></td>
    <td><img width="200"  alt="degraded_medium" src="https://github.com/user-attachments/assets/96444005-f968-41a9-86d6-74350fc24864" /></td>
    <td><img width="200"  alt="degraded_coarse" src="https://github.com/user-attachments/assets/6a2e0cbe-2488-4a19-90bb-8a96ee1b298c" /></td>
  </tr>
</table>

### Общий вид стака изображений ###
<img width="400"  alt="6Segment_01" src="https://github.com/user-attachments/assets/21bc7c09-c1ff-4404-90ed-e4339c4405e0" />

Размеры стаков:
<ul>
  <li><b>pristine_fine</b>    (995x1304x733 вокселей),  </li>
  <li><b>pristine_medium</b>  (960x1110x610 вокселей)</li>
  <li><b>pristine_coarse</b>  (744x1417x456 вокселей)</li>
  <li><b>degraded_fine</b>    (1171x1343x461 вокселей)</li>
  <li><b>degraded_medium</b>  (1318x1520x459 вокселей)</li>
  <li><b>degraded_coarse</b>  (1368x1630x500 вокселей)</li> 
</ul>

Обработка массива размером 995x1304x733 значений - 951 млн.параметров требует огромных вычислительных мощностей, поэтому каждый стек будет разделен на патчи (кубики) размерами 456х456х456.
Размерность 456 взята как минимальная сторона у стака **pristine_coarse**.
Также разделение стака на патчи увеличивает численное количество уникальных образцов для обучающей выборки.

# Загрузка и подготовка данных 
Пайплайном `FIBs_download.py` выполняется последовательность:

1. Скачивание FIB-снимков.
2. Складирование FIB-снимков в соответсвующие стаки.
3. Нормализация (приведение к значениям 0 - поры, 1 - YSZ, 2 - Ni).
4. Разделение стаков на патчи меньшего размера.
5. Сохранение каждого патча (массива `nd.array`) в `*.npy` файл.
6. Возврат списка сохраненных `*.npy` файлов.

`FIBs_download.py`
```
get_data(output='2D', output_dir='./data/', cube_size=456, overlap_fraction=0.5, balance=False, to_archive=False)
'''
Аргументы:
  output: string
    Требуемая размерность выходных данных
    Значения: 
      2D - двумерный выход .shape(y,x) 
      3D - трехмерный выход .shape(z,y,x)
  output_dir: string
    Директория для сохранения обработанных данных
  
  cube_size: integer
    размер кубического патча
  
  overlap_fraction: float (0-1)
    доля перекрытия между соседними патчами (0-1)

  balance: boolean
    Требуется ли балансировать выходные классы по количеству (True, False) 

  to_archive: boolean
    Требуется ли сохранить в архив выходные файлы 
'''

return [список *.npy файлов]
```







